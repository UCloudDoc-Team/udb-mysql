

# 只读组管理

云数据库UDB MySQL支持用户创建多个只读从库组成只读组，只读组中的只读从库可以实现负载均衡的能力，用户可以根据业务需求，合理的配置只读组中的只读从库数量，从而实现业务的负载均衡。
只读组是只读从库的集合，一个只读组共享一个地址，同时还可以设置其中只读实例的权重进行流量负载均衡、设置延迟剔除、同步中断剔除等。用户可根据需要创建只读组，并将相应的读请求按一定规则发送到只读从库。配置同一个只读组内的多个只读从库可起到容灾的作用。

## 前提条件

创建只读组之前，需要先创建云数据库UDB MySQL主库。请参见[创建MySQL实例](https://docs.ucloud.cn/udb-mysql/quick/create)

## 创建只读组

点击MySQL的“详情”进入详情页面，点击页面的“数据库代理”，进入数据库代理入口，再点击只读组，进入只读组入口。

![image](/images/只读组入口.png)

![image](/images/创建只读组界面1.png)

![image](/images/创建只读组界面2.png)

#### 选项解释

- 故障宕机：当只读从库可用性出现异常，只读组会自动剔除故障实例，等待故障实例恢复正常再加入只读组。该选项默认开启，不支持关闭。
- 同步中断：当只读从库同步主库出现异常，只读组会自动剔除故障实例，等待同步恢复正常再加入只读组。
- 延迟剔除：当只读从库延迟超过设置的阈值，只读组会自动剔除只读从库，等待延迟低于阈值再加入只读组。
- 最少保留实例数：在只读组自动剔除异常节点时，如果没剔除的节点数量小于等于最少保留实例数，则不再剔除异常节点。
- 平均分配：平均分配只读组的流量到只读组内的只读从库。
- 自定义： 自定义只读组的流量分配，这里要保证所有节点的权重和为100。

## 配置只读组

点击只读组“详情”进入详情页面

![image](/images/只读组详情入口.png)

在只读组详情页面上方是基本的描述信息，详情页面左侧是异常剔除配置及网络信息，详情页面右侧是只读组节点相关的配置。

![image](/images/只读组详情页.png)

点击“可添加的数据库”下方列出的数据库左侧的加号，可以将只读从库加入只读组。一个只读从库只能加入一个只读组。下图为添加只读从库到只读组的界面。

在添加只读从库到只读组时，可以重新配置只读组内各个节点的读权重，可以选择是否重新负载均衡。

如果不选择重新负载均衡，则存量的连接还是会按照原有的权重分布在各个节点，只有新创建的连接，才会按照重新调整过的权重分布。如果选择重新负载均衡，则存量连接会断开，保证所有的连接都是按照重新调整过的权重分布。所以在重新负载均衡时，会有闪断的现象，需要保证业务有重连机制。

![image](/images/只读组添加只读从库.png)

在只读组详情页面的右侧，可以编辑只读组的读权重信息。可以平均分配权重或者自定义权重。可以选择是否重新负载均衡。

![image](/images/只读组编辑读权重.png)

点击下图中框选出的按钮，可以将只读从库从只读组中移除。移除只读从库后，只读组内剩余的节点会按比例重新分配读权重。

![image](/images/移除只读组节点.png)

## 删除只读组

![image](/images/删除只读组.png)